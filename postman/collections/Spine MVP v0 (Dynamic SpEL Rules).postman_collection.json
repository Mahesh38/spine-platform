{
  "info": {
    "_postman_id": "bc347782-8b2f-45de-97a1-3d23d2d2a3b2",
    "name": "Spine MVP v0 (Dynamic SpEL Rules)",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "0) Health (optional)",
      "id": "1a37104c-39ee-48dd-a30b-682e8ca907da",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/actuator/health",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "actuator",
            "health"
          ]
        }
      },
      "response": []
    },
    {
      "name": "1) Create Entity (Company)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status 200', function () {",
              "  pm.response.to.have.status(200);",
              "});",
              "const json = pm.response.json();",
              "pm.collectionVariables.set('entityId', json.id);",
              "console.log('entityId:', json.id);"
            ],
            "type": "text/javascript",
            "id": "37f0dcb8-0dc7-42a7-9654-49b9221a8029"
          }
        }
      ],
      "id": "021da1df-db37-46c4-937a-cf93e2d429ea",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"type\": \"Company\",\n  \"name\": \"ABC Traders\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/api/entities",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "entities"
          ]
        }
      },
      "response": []
    },
    {
      "name": "2) Create Commitment (Invoice Payment) + attributes (dueAt etc.)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status 200', function () {",
              "  pm.response.to.have.status(200);",
              "});",
              "const json = pm.response.json();",
              "pm.collectionVariables.set('commitmentId', json.id);",
              "console.log('commitmentId:', json.id);"
            ],
            "type": "text/javascript",
            "id": "add1b86b-46ac-416b-bf28-2550a4b4bd58"
          }
        }
      ],
      "id": "4bab9d46-0b74-4c8c-9a1f-97766d10a1d4",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"title\": \"Invoice INV-001 Payment\",\n  \"ownerEntityId\": \"{{entityId}}\",\n  \"attributes\": {\n    \"dueAt\": \"2026-01-25T10:00:00Z\",\n    \"amount\": 45000,\n    \"invoiceNo\": \"INV-001\"\n  }\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/api/commitments",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "commitments"
          ]
        }
      },
      "response": []
    },
    {
      "name": "3) Configure Commitment (Invoice Rules via SpEL)",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "id": "598232a5-6e91-494f-8d8a-6cb65ee4cc43",
            "exec": [
              "// Build config JSON dynamically so we don't manually escape it",
              "const cfg = {",
              "  states: ['CREATED','ACTIVE','FULFILLED','VIOLATED'],",
              "  initial: 'CREATED',",
              "  transitions: {",
              "    CREATED: ['ACTIVE'],",
              "    ACTIVE: ['FULFILLED','VIOLATED']",
              "  },",
              "  rules: [",
              "    {",
              "      name: 'fulfill_on_payment',",
              "      when: \"evidenceKinds.contains('payment')\",",
              "      then: \"#A.setState('FULFILLED')\"",
              "    },",
              "    {",
              "      name: 'violate_when_overdue',",
              "      when: \"state == 'ACTIVE' && #F.parseInstant(commitment['dueAt']) != null && now.isAfter(#F.parseInstant(commitment['dueAt']))\",",
              "      then: \"#A.setState('VIOLATED')\"",
              "    }",
              "  ]",
              "};",
              "pm.collectionVariables.set('configJson', JSON.stringify(cfg));",
              "console.log('configJson set');"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        },
        {
          "listen": "test",
          "script": {
            "id": "92e41a33-5793-4a00-aa9b-f405d1568b0a",
            "exec": [
              "pm.test('Status 200', function () {",
              "  pm.response.to.have.status(200);",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "id": "30b3ce55-b106-4a59-9570-ae83dc93a75e",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "X-Tenant-Id",
            "value": "t1",
            "type": "text",
            "uuid": "65375c4d-2b6d-4b25-8ba6-da065c1d13ed"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"configJson\": \"{\\\"states\\\":[\\\"CREATED\\\",\\\"ACTIVE\\\",\\\"FULFILLED\\\",\\\"VIOLATED\\\"],\\\"initial\\\":\\\"CREATED\\\",\\\"transitions\\\":{\\\"CREATED\\\":[\\\"ACTIVE\\\"],\\\"ACTIVE\\\":[\\\"FULFILLED\\\",\\\"VIOLATED\\\"],\\\"VIOLATED\\\":[\\\"FULFILLED_LATE\\\"]},\\\"rules\\\":[{\\\"name\\\":\\\"fulfill_on_payment\\\",\\\"when\\\":\\\"#state == 'ACTIVE' && #evidenceKinds.contains('payment')\\\",\\\"then\\\":\\\"#A.setState('FULFILLED')\\\"},{\\\"name\\\":\\\"violate_when_overdue\\\",\\\"when\\\":\\\"#state == 'ACTIVE' && #F.parseInstant(#commitment['dueAt']) != null && #now.isAfter(#F.parseInstant(#commitment['dueAt']))\\\",\\\"then\\\":\\\"#A.setState('VIOLATED')\\\"},{\\\"name\\\":\\\"fulfill_on_payment_when_overdue\\\",\\\"when\\\":\\\"#state == 'VIOLATED' && #evidenceKinds.contains('payment')\\\",\\\"then\\\":\\\"#A.setState('FULFILLED_LATE')\\\"}]}\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/api/commitments/{{commitmentId}}/configure",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "commitments",
            "{{commitmentId}}",
            "configure"
          ]
        }
      },
      "response": []
    },
    {
      "name": "4) Activate Commitment",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status 200', function () {",
              "  pm.response.to.have.status(200);",
              "});"
            ],
            "type": "text/javascript",
            "id": "7cce8b33-78ab-4d57-9535-3bea08485e9d"
          }
        }
      ],
      "id": "fbcbf9ca-dbb6-4d22-a427-538acab5887a",
      "request": {
        "method": "POST",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/api/commitments/{{commitmentId}}/activate",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "commitments",
            "{{commitmentId}}",
            "activate"
          ]
        }
      },
      "response": []
    },
    {
      "name": "5) Evaluate (before evidence) — should stay ACTIVE (unless overdue)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status 200', function () {",
              "  pm.response.to.have.status(200);",
              "});",
              "const json = pm.response.json();",
              "console.log('state after eval:', json.state);"
            ],
            "type": "text/javascript",
            "id": "05c2a40f-7b51-4da9-98ef-e81c947fd99c"
          }
        }
      ],
      "id": "716acdfb-47ef-48cd-a175-fa5973c142c1",
      "request": {
        "method": "POST",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/api/commitments/{{commitmentId}}/evaluate",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "commitments",
            "{{commitmentId}}",
            "evaluate"
          ]
        }
      },
      "response": []
    },
    {
      "name": "6) Add Evidence (Payment)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status 200', function () {",
              "  pm.response.to.have.status(200);",
              "});"
            ],
            "type": "text/javascript",
            "id": "85e69fd1-bccd-472b-a3d3-463e71d29e72"
          }
        }
      ],
      "id": "aad370a4-1f55-44c0-87e3-4d3320001221",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"attributes\": {\n    \"kind\": \"payment\",\n    \"utr\": \"12345\",\n    \"paidAt\": \"2026-01-20T10:00:00Z\"\n  }\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/api/commitments/{{commitmentId}}/evidence",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "commitments",
            "{{commitmentId}}",
            "evidence"
          ]
        }
      },
      "response": []
    },
    {
      "name": "7) Evaluate (after payment) — should become FULFILLED",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status 200', function () {",
              "  pm.response.to.have.status(200);",
              "});",
              "const json = pm.response.json();",
              "pm.test('State is FULFILLED', function () {",
              "  pm.expect(json.state).to.eql('FULFILLED');",
              "});",
              "console.log('final state:', json.state);"
            ],
            "type": "text/javascript",
            "id": "521bb8d9-c2ca-48e4-9c38-639f464ee8d7"
          }
        }
      ],
      "id": "b50acb49-42bb-45ec-b7cd-093296759c7e",
      "request": {
        "method": "POST",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/api/commitments/{{commitmentId}}/evaluate",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "commitments",
            "{{commitmentId}}",
            "evaluate"
          ]
        }
      },
      "response": []
    },
    {
      "name": "8) Get Commitment (final)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status 200', function () {",
              "  pm.response.to.have.status(200);",
              "});",
              "const json = pm.response.json();",
              "console.log('commitment:', json);"
            ],
            "type": "text/javascript",
            "id": "f1cbc4bc-997f-487c-b793-c6f96609fb8f"
          }
        }
      ],
      "id": "70e3e374-02d8-4ef7-8c04-9aa2a35eb126",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/api/commitments/{{commitmentId}}",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "commitments",
            "{{commitmentId}}"
          ]
        }
      },
      "response": []
    },
    {
      "name": "8.1)Get Commitment Audit Trail",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "id": "d900e8e2-a21b-46fc-8b9f-73ce17a3339b",
            "exec": [
              ""
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        },
        {
          "listen": "test",
          "script": {
            "id": "5e57e9b5-9c4b-48f5-9091-d99c680a461f",
            "exec": [
              "pm.test('Status 200', function () {\r",
              "  pm.response.to.have.status(200);\r",
              "});\r",
              "const json = pm.response.json();\r",
              "console.log('commitment audit Trail:', json);"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "id": "da104f21-a5a1-42b3-9d0b-0b31e4c31ff2",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "X-Tenant-Id",
            "value": "t1",
            "type": "text",
            "uuid": "195333e9-d28e-4f25-94ab-17dd065d1c23"
          }
        ],
        "url": {
          "raw": "http://localhost:8080/api/audit/commitments/{{commitmentId}}",
          "protocol": "http",
          "host": [
            "localhost"
          ],
          "port": "8080",
          "path": [
            "api",
            "audit",
            "commitments",
            "{{commitmentId}}"
          ]
        }
      },
      "response": []
    },
    {
      "name": "9) (Optional) Audit Vertical Demo — Create new Commitment (Audit Doc Submission)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status 200', function () {",
              "  pm.response.to.have.status(200);",
              "});",
              "const json = pm.response.json();",
              "pm.collectionVariables.set('auditCommitmentId', json.id);",
              "console.log('auditCommitmentId:', json.id);"
            ],
            "type": "text/javascript",
            "id": "27c40b08-91cc-4168-8052-02910c5bb42a"
          }
        }
      ],
      "id": "040e07d4-0ce4-4411-ad11-cc709056b3d8",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"title\": \"Audit Submission: Bank Statement\",\n  \"ownerEntityId\": \"{{entityId}}\",\n  \"attributes\": {\n    \"docType\": \"bank-statement\"\n  }\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/api/commitments",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "commitments"
          ]
        }
      },
      "response": []
    },
    {
      "name": "10) (Optional) Audit Config + Activate + Upload Document + Evaluate",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "const cfg = {",
              "  states: ['CREATED','ACTIVE','FULFILLED','VIOLATED'],",
              "  initial: 'CREATED',",
              "  transitions: {",
              "    CREATED: ['ACTIVE'],",
              "    ACTIVE: ['FULFILLED','VIOLATED']",
              "  },",
              "  rules: [",
              "    {",
              "      name: 'fulfill_on_document',",
              "      when: \"evidenceKinds.contains('document')\",",
              "      then: \"#A.setState('FULFILLED')\"",
              "    }",
              "  ]",
              "};",
              "pm.collectionVariables.set('auditConfigJson', JSON.stringify(cfg));"
            ],
            "type": "text/javascript",
            "id": "a8a3a6f9-c898-45f8-9291-ff3b1f50e851"
          }
        },
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status 200', function () {",
              "  pm.response.to.have.status(200);",
              "});"
            ],
            "type": "text/javascript",
            "id": "12bf699f-7439-41fc-a61b-dc0d2e408890"
          }
        }
      ],
      "id": "13027168-9eda-4139-9695-9d30c0c4061f",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"configJson\": \"{{auditConfigJson}}\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/api/commitments/{{auditCommitmentId}}/configure",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "commitments",
            "{{auditCommitmentId}}",
            "configure"
          ]
        }
      },
      "response": []
    },
    {
      "name": "11) (Optional) Audit Activate",
      "id": "f6293bdf-16fc-4c2b-9be0-ada34b163f21",
      "request": {
        "method": "POST",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/api/commitments/{{auditCommitmentId}}/activate",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "commitments",
            "{{auditCommitmentId}}",
            "activate"
          ]
        }
      },
      "response": []
    },
    {
      "name": "12) (Optional) Audit Add Evidence (Document)",
      "id": "efa6e6e9-53ab-4a4f-8e4d-f24cfe614485",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"attributes\": {\n    \"kind\": \"document\",\n    \"fileName\": \"bank-statement.pdf\"\n  }\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/api/commitments/{{auditCommitmentId}}/evidence",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "commitments",
            "{{auditCommitmentId}}",
            "evidence"
          ]
        }
      },
      "response": []
    },
    {
      "name": "13) (Optional) Audit Evaluate (should become FULFILLED)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status 200', function () {",
              "  pm.response.to.have.status(200);",
              "});",
              "const json = pm.response.json();",
              "pm.test('State is FULFILLED', function () {",
              "  pm.expect(json.state).to.eql('FULFILLED');",
              "});",
              "console.log('audit final state:', json.state);"
            ],
            "type": "text/javascript",
            "id": "441269b1-a8f9-400a-82df-ebd79d123c13"
          }
        }
      ],
      "id": "cae07ad3-ef79-43b1-a96b-1d91dfafa636",
      "request": {
        "method": "POST",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/api/commitments/{{auditCommitmentId}}/evaluate",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "commitments",
            "{{auditCommitmentId}}",
            "evaluate"
          ]
        }
      },
      "response": []
    }
  ],
  "variable": [
    {
      "id": "662b0735-b235-46bb-b20f-bf4dd9941c1d",
      "key": "baseUrl",
      "value": "http://localhost:8080"
    },
    {
      "id": "8d535394-f7aa-48f2-beed-ebda853acba0",
      "key": "entityId",
      "value": ""
    },
    {
      "id": "cbe0cd31-647d-46a2-bd78-845cacb485a4",
      "key": "commitmentId",
      "value": ""
    },
    {
      "id": "a604398d-7355-49fb-8d21-38e2735be5b9",
      "key": "configJson",
      "value": ""
    }
  ]
}